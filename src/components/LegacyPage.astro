---
import BaseLayout from '../layouts/BaseLayout.astro';
import { parseLegacyHtml } from '../utils/legacy';
import testimonialsSnippet from '../legacy/testimonials-snippet.html?raw';

interface Props {
  html: string;
}

const { html } = Astro.props as Props;
const site = Astro.site ?? Astro.url;

function toHtmlPath(pathname: string) {
  if (!pathname || pathname === '/') {
    return '/index.html';
  }

  const trimmedPath = pathname.endsWith('/') ? pathname.slice(0, -1) : pathname;

  if (trimmedPath.endsWith('.html')) {
    return trimmedPath;
  }

  return `${trimmedPath}.html`;
}

const htmlPath = toHtmlPath(Astro.url.pathname);
const pageUrl = new URL(htmlPath, site).toString();

const { head, body } = parseLegacyHtml(html, {
  testimonialsSnippet,
  pageUrl,
});
---

<BaseLayout>
  <Fragment slot="head" set:html={head} />
  <Fragment set:html={body} />
</BaseLayout>
