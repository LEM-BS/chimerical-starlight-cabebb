---
import BaseLayout from '../layouts/BaseLayout.astro';
import HomeInstantEstimate from '../components/HomeInstantEstimate';

const conversionSendToValue =
  import.meta.env.PUBLIC_GOOGLE_ADS_CONVERSION_SEND_TO?.trim();
const hasConversionSendTo =
  typeof conversionSendToValue === 'string' &&
  conversionSendToValue.length > 0 &&
  !conversionSendToValue.includes('XXXX');
const conversionSendToAttribute = hasConversionSendTo
  ? conversionSendToValue
  : undefined;
---

<BaseLayout>
  <Fragment slot="head">
    <title>Request a Property Survey | LEM Building Surveying</title>
        <meta content="Submit your property details to request a free, no-obligation quote for a building survey, damp report, EPC, or floorplan. Serving Deeside, Chester &amp; the North West." name="description">
        <link rel="canonical" href="https://lembuildingsurveying.co.uk/enquiry">
        <link rel="stylesheet" href="/assets/lem-quote.min.css">
        <meta property="og:title" content="Request a Property Survey | LEM Building Surveying">
        <meta property="og:description" content="Submit your property details to request a free, no-obligation quote for a building survey, damp report, EPC, or floorplan. Serving Deeside, Chester &amp; the North West.">
        <meta property="og:url" content="https://lembuildingsurveying.co.uk/enquiry">
        <meta property="og:image" content="https://lembuildingsurveying.co.uk/logo-sticker.png">
        <meta name="twitter:card" content="summary_large_image">
        <meta name="twitter:title" content="Request a Property Survey | LEM Building Surveying">
        <meta name="twitter:description" content="Submit your property details to request a free, no-obligation quote for a building survey, damp report, EPC, or floorplan. Serving Deeside, Chester &amp; the North West.">
        <meta name="twitter:url" content="https://lembuildingsurveying.co.uk/enquiry">
        <meta name="twitter:image" content="https://lembuildingsurveying.co.uk/logo-sticker.png">
        <!-- Preconnect & Google Fonts -->



        <!-- Main stylesheet -->



        <!-- Usercentrics & GA4 -->
  </Fragment>

  <!-- ENQUIRY PAGE --><section class="enquiry-page">
        <div class="box-container">
          <h1>Request a Property Survey</h1>
          <p>
            Complete the form below and Liam will be in touch to confirm details
            or provide a tailored quote—no obligation.
          </p>
          <!-- Formspree: _next ensures redirect after successful send -->
          <form
            action="https://formspree.io/f/xzzdqqqz"
            class="enquiry-form"
            data-conversion-send-to={conversionSendToAttribute}
            method="POST"
          >
            <input name="_next" type="hidden" value="https://lembuildingsurveying.co.uk/thank-you">
              <HomeInstantEstimate client:load />
            <label for="name">Full Name:</label>
            <input id="name" name="name" required="" type="text">

            <label for="email">Email Address:</label>
            <input id="email" name="email" required="" type="email">

            <label for="phone">Phone Number:</label>
            <input id="phone" name="phone" required="" type="tel">

            <label for="contact-method">Preferred Contact Method:</label>
            <select id="contact-method" name="contact-method" required="">
              <option value="">-- Please Select --</option>
              <option value="email">Email</option>
              <option value="phone-call">Phone Call</option>
              <option value="text-message">SMS / Text Message</option>
              <option value="whatsapp">WhatsApp</option>
              <option value="no-preference">No Preference</option>
            </select>

            <label for="survey-type">Survey Type:</label>
            <select id="survey-type" name="survey-type" required="">
              <option value="">-- Please Select --</option>
              <option value="level-1">RICS Level 1 Home Survey</option>
              <option value="level-2">RICS Level 2 Home Survey</option>
              <option value="level-3">RICS Level 3 Home Survey</option>
              <option value="timber-and-damp">Timber and Damp Investigation</option>
              <option value="damp-survey">Damp Survey</option>
              <option value="damp-and-mould">Damp and Mould Survey</option>
              <option value="epc">EPC with Floorplan</option>
              <option value="measured">Measured Survey &amp; Floorplan</option>
              <option value="ventilation">Ventilation Assessment</option>
              <option value="unsure">Unsure – Please advise</option>
            </select>

            <label for="address">Property Address:</label>
            <input id="address" name="address" placeholder="123 High Street, Flintshire" type="text">

            <label for="property-value">Estimated Property Value (£):</label>
            <input id="property-value" inputmode="decimal" min="0.01" name="property-value" placeholder="e.g. 250000" step="0.01" type="number">

            <label for="bedrooms">Number of Bedrooms:</label>
            <input id="bedrooms" name="bedrooms" placeholder="e.g. 3" type="number" min="0">

            <label for="details">Additional Notes:</label>
            <textarea id="details" name="details" placeholder="Any known issues, preferred times, or questions." rows="4"></textarea>
            <button class="cta-button" type="submit">Submit Enquiry</button>
          </form>
          <p class="thank-you-note">
            Thank you—we’ll be in touch shortly to help with your survey needs.
          </p>
        </div>
      </section><script is:inline>
        document.addEventListener("DOMContentLoaded", () => {
          const form = document.querySelector(".enquiry-form");
          if (!form) {
            return;
          }

          const conversionSendTo = form.dataset.conversionSendTo || null;
          const propertyValueInput = form.querySelector("#property-value");

          const normalisePropertyValue = () => {
            if (!propertyValueInput) {
              return;
            }

            const rawValue = propertyValueInput.value.trim();
            if (rawValue === "") {
              propertyValueInput.setCustomValidity("");
              return;
            }

            const numericValue = Number(rawValue);
            if (!Number.isFinite(numericValue) || numericValue <= 0) {
              propertyValueInput.setCustomValidity(
                "Please enter a positive number.",
              );
            } else {
              propertyValueInput.setCustomValidity("");
              propertyValueInput.value = rawValue;
            }
          };

          if (propertyValueInput) {
            propertyValueInput.addEventListener("input", normalisePropertyValue);
            propertyValueInput.addEventListener("blur", normalisePropertyValue);
          }

          form.addEventListener("submit", async (e) => {
            e.preventDefault();
            normalisePropertyValue();

            if (!form.checkValidity()) {
              form.reportValidity();
              return;
            }
            const data = new FormData(form);

            if (propertyValueInput) {
              data.set("property-value", propertyValueInput.value.trim());
            }

            const resp = await fetch("https://formspree.io/f/xzzdqqqz", {
              method: "POST",
              body: data,
              headers: { Accept: "application/json" },
            });

            if (resp.ok) {
              /* fire Google Ads conversion before leaving */
              if (
                conversionSendTo &&
                typeof window !== "undefined" &&
                typeof window.gtag === "function"
              ) {
                window.gtag("event", "conversion", {
                  send_to: conversionSendTo,
                });
              }
              window.location = "/thank-you";
            } else {
              alert("Sorry, something went wrong. Please email us directly.");
            }
          });
        });
      </script>
</BaseLayout>
